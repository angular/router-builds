{"version":3,"file":"router-testing.umd.js","sources":["../../../../packages/router/testing/src/testing.ts","../../../../packages/router/testing/src/router_testing_module.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of the router/testing package.\n */\nexport * from './router_testing_module';\n","/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Location, LocationStrategy} from '@angular/common';\nimport {MockLocationStrategy, SpyLocation} from '@angular/common/testing';\nimport {Compiler, Injectable, Injector, ModuleWithProviders, NgModule, NgModuleFactory, NgModuleFactoryLoader, Optional} from '@angular/core';\nimport {NoPreloading, PreloadingStrategy, ROUTES, Route, Router, RouterModule, RouterOutletMap, Routes, UrlHandlingStrategy, UrlSerializer, provideRoutes, ɵROUTER_PROVIDERS as ROUTER_PROVIDERS, ɵflatten as flatten} from '@angular/router';\n\n\n\n/**\n * @whatItDoes Allows to simulate the loading of ng modules in tests.\n *\n * @howToUse\n *\n * ```\n * const loader = TestBed.get(NgModuleFactoryLoader);\n *\n * @Component({template: 'lazy-loaded'})\n * class LazyLoadedComponent {}\n * @NgModule({\n *   declarations: [LazyLoadedComponent],\n *   imports: [RouterModule.forChild([{path: 'loaded', component: LazyLoadedComponent}])]\n * })\n *\n * class LoadedModule {}\n *\n * // sets up stubbedModules\n * loader.stubbedModules = {lazyModule: LoadedModule};\n *\n * router.resetConfig([\n *   {path: 'lazy', loadChildren: 'lazyModule'},\n * ]);\n *\n * router.navigateByUrl('/lazy/loaded');\n * ```\n *\n * @stable\n */\n\nexport class SpyNgModuleFactoryLoader implements NgModuleFactoryLoader {\n  /**\n   * @docsNotRequired\n   */\n  private _stubbedModules: {[path: string]: Promise<NgModuleFactory<any>>} = {};\n\n  /**\n   * @docsNotRequired\n   */\n  set stubbedModules(modules: {[path: string]: any}) {\n    const res: {[path: string]: any} = {};\n    for (const t of Object.keys(modules)) {\n      res[t] = this.compiler.compileModuleAsync(modules[t]);\n    }\n    this._stubbedModules = res;\n  }\n\n  /**\n   * @docsNotRequired\n   */\n  get stubbedModules(): {[path: string]: any} { return this._stubbedModules; }\n\n  constructor(private compiler: Compiler) {}\n\n  load(path: string): Promise<NgModuleFactory<any>> {\n    if (this._stubbedModules[path]) {\n      return this._stubbedModules[path];\n    } else {\n      return <any>Promise.reject(new Error(`Cannot find module ${path}`));\n    }\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: Compiler, },\n];\n}\n\n/**\n * Router setup factory function used for testing.\n *\n * @stable\n */\nexport function setupTestingRouter(\n    urlSerializer: UrlSerializer, outletMap: RouterOutletMap, location: Location,\n    loader: NgModuleFactoryLoader, compiler: Compiler, injector: Injector, routes: Route[][],\n    urlHandlingStrategy?: UrlHandlingStrategy) {\n  const router = new Router(\n      null, urlSerializer, outletMap, location, injector, loader, compiler, flatten(routes));\n  if (urlHandlingStrategy) {\n    router.urlHandlingStrategy = urlHandlingStrategy;\n  }\n  return router;\n}\n\n/**\n * @whatItDoes Sets up the router to be used for testing.\n *\n * @howToUse\n *\n * ```\n * beforeEach(() => {\n *   TestBed.configureTestModule({\n *     imports: [\n *       RouterTestingModule.withRoutes(\n *         [{path: '', component: BlankCmp}, {path: 'simple', component: SimpleCmp}])]\n *       )\n *     ]\n *   });\n * });\n * ```\n *\n * @description\n *\n * The modules sets up the router to be used for testing.\n * It provides spy implementations of {@link Location}, {@link LocationStrategy}, and {@link\n * NgModuleFactoryLoader}.\n *\n * @stable\n */\n\nexport class RouterTestingModule {\n  static withRoutes(routes: Routes): ModuleWithProviders {\n    return {ngModule: RouterTestingModule, providers: [provideRoutes(routes)]};\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: NgModule, args: [{\n  exports: [RouterModule],\n  providers: [\n    ROUTER_PROVIDERS, {provide: Location, useClass: SpyLocation},\n    {provide: LocationStrategy, useClass: MockLocationStrategy},\n    {provide: NgModuleFactoryLoader, useClass: SpyNgModuleFactoryLoader}, {\n      provide: Router,\n      useFactory: setupTestingRouter,\n      deps: [\n        UrlSerializer, RouterOutletMap, Location, NgModuleFactoryLoader, Compiler, Injector, ROUTES,\n        [UrlHandlingStrategy, new Optional()]\n      ]\n    },\n    {provide: PreloadingStrategy, useExisting: NoPreloading}, provideRoutes([])\n  ]\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"],"names":["UrlHandlingStrategy","Optional","UrlSerializer","RouterOutletMap","Location","NgModuleFactoryLoader","Compiler","Injector","ROUTES","Router","LocationStrategy","MockLocationStrategy","ɵROUTER_PROVIDERS","SpyLocation","RouterModule","NgModule","ROUTER_PROVIDERS","provideRoutes","ɵflatten","Injectable"],"mappings":";;;;;;;;;;ICAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAiDU,IAAV,CAAA,QAAA,GAAA,QAAA,CAA+E;;;;;KAK/E;IAIA,MAAA,CAAA,cAAA,CAAA,wBAAA,CAAA,SAAA,EAAA,gBAAA,EAAA;;;;QAcA,GAAA,EAAA,YAAA,EAAA,OAAA,IAAA,CAAA,eAAA,CAAA,EAAA;;;;QAdA,GAAA,EAAA,UAAA,OAAA,EAAA;YACI,IAAJ,GAAA,GAAA,EAAA,CAAA;YACA,KAAA,IAAA,EAAA,GAAA,CAAA,EAAA,EAAA,GAAA,MAAA,CAAA,IAAA,CAAA,OAAA,CAAA,EAAA,EAAA,GAAA,EAAA,CAAA,MAAA,EAAA,EAAA,EAAA,EAAA;gBAAA,IAAA,CAAA,GAAA,EAAA,CAAA,EAAA,CAAA,CAAA;;;;SAKA;;;KAAA,CAAA,CAAA;IAOA,wBAAA,CAAA,SAAA,CAAA,IAAA,GAAA,UAAA,IAAW,EAAX;QACA,IAAM,IAAN,CAAA,eAAA,CAAgC,IAAhC,CAAqC,EAArC;YACA,OAAA,IAAA,CAAA,eAAA,CAAA,IAAA,CAAA,CAAA;SACA;;YACA,OAAA,OAAA,CAAA,MAAA,CAAA,IAA2C,KAA3C,CAAA,qBAAA,GAAA,IAAA,CAAA,CAAA,CAAA;SACA;KACA,CAAA;;;AAEO,wBAAP,CAAA,UAAA,GAAA;IACA,EAAC,IAAI,EAAEmB,wBAAP,EAAA;CACC,CAAC;;;;;;;;;;AAgBF,SAAA,kBAAA,CAAA,aAAA,EAAA,SAAA,EAAA,QAAA,EAAA,MAAA,EAAA,QAAA,EAAA,QAAA,EAAA,MAAA,EAAA,mBAAA,EAAA;IACE,IAAF,MAAA,GAAA,IAAAV,sBAAA,CAAA,IAAA,EAAA,aAAA,EAAA,SAAA,EAAA,QAAA,EAAA,QAAA,EAAA,MAAA,EAAA,QAAA,EAAAS,wBAAA,CAAA,MAAA,CAAA,CAAA,CAAA;IACA,IAAA,mBAAA,EAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAmCA;IAHA,mBAAA,CAAA,UAAA,GAAA,UAAA,MAAA,EAAA;QACA,OAAA,EAAA,QAAA,EAAA,mBAAA,EAAA,SAAA,EAAA,CAAAD,6BAAA,CAAA,MAAA,CAAA,CAAA,EAAA,CAAA;KACA,CAAA;IACA,OAAA,mBAAA,CAAA;CAAA,EAAA,CAAA,CAAA;AACAD,mBAAAA,CAAIA,UAAJA,GAAAA;IACA,EAAA,IAAA,EAAAD,sBAAI,EAAC,IAAL,EAAA,CAAY;gBACZ,OAAA,EAAA,CAAAD,4BAAA,CAAA;gBACA,SAAA,EAAA;oBACAF,iCAAA,EAAA,EAAA,OAAA,EAAAR,wBAAA,EAAA,QAAA,EAAAS,mCAAA,EAAA;oBACA,EAAA,OAAA,EAAAH,gCAAA,EAAA,QAAA,EAAAC,4CAAA,EAAA;oBACA,EAAA,OAAA,EAAAN,mCAAA,EAAA,QAAA,EAAA,wBAAA,EAAA,EAAA;wBACA,OAAA,EAAAI,sBAAA;wBACA,UAAA,EAAA,kBAAA;wBACA,IAAA,EAAA;4BACAP,6BAAA,EAAAC,+BAAA,EAAAC,wBAAA,EAAAC,mCAAA,EAA2EC,sBAA3E,EAAAC,sBAAA,EAAAC,sBAAA;4BACA,CAAAR,mCAAA,EAAA,IAAAC,sBAAA,EAAA,CAAA;yBACA;qBACA;;iBAEA;;CDvJA,CAAA;;;;;;;;;;"}