/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/// <reference types="@types/dom-view-transitions" />
import { DOCUMENT } from '@angular/common';
import { afterNextRender, InjectionToken, NgZone, runInInjectionContext, } from '@angular/core';
export const CREATE_VIEW_TRANSITION = new InjectionToken(ngDevMode ? 'view transition helper' : '');
export const VIEW_TRANSITION_OPTIONS = new InjectionToken(ngDevMode ? 'view transition options' : '');
/**
 * A helper function for using browser view transitions. This function skips the call to
 * `startViewTransition` if the browser does not support it.
 *
 * @returns A Promise that resolves when the view transition callback begins.
 */
export function createViewTransition(injector, from, to) {
    const transitionOptions = injector.get(VIEW_TRANSITION_OPTIONS);
    const document = injector.get(DOCUMENT);
    // Create promises outside the Angular zone to avoid causing extra change detections
    return injector.get(NgZone).runOutsideAngular(() => {
        if (!document.startViewTransition || transitionOptions.skipNextTransition) {
            transitionOptions.skipNextTransition = false;
            return Promise.resolve();
        }
        let resolveViewTransitionStarted;
        const viewTransitionStarted = new Promise((resolve) => {
            resolveViewTransitionStarted = resolve;
        });
        const transition = document.startViewTransition(() => {
            resolveViewTransitionStarted();
            // We don't actually update dom within the transition callback. The resolving of the above
            // promise unblocks the Router navigation, which synchronously activates and deactivates
            // routes (the DOM update). This view transition waits for the next change detection to
            // complete (below), which includes the update phase of the routed components.
            return createRenderPromise(injector);
        });
        const { onViewTransitionCreated } = transitionOptions;
        if (onViewTransitionCreated) {
            runInInjectionContext(injector, () => onViewTransitionCreated({ transition, from, to }));
        }
        return viewTransitionStarted;
    });
}
/**
 * Creates a promise that resolves after next render.
 */
function createRenderPromise(injector) {
    return new Promise((resolve) => {
        afterNextRender(resolve, { injector });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld190cmFuc2l0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvcm91dGVyL3NyYy91dGlscy92aWV3X3RyYW5zaXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgscURBQXFEO0FBRXJELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQ0wsZUFBZSxFQUNmLGNBQWMsRUFFZCxNQUFNLEVBQ04scUJBQXFCLEdBQ3RCLE1BQU0sZUFBZSxDQUFDO0FBSXZCLE1BQU0sQ0FBQyxNQUFNLHNCQUFzQixHQUFHLElBQUksY0FBYyxDQUN0RCxTQUFTLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQzFDLENBQUM7QUFDRixNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxJQUFJLGNBQWMsQ0FFdkQsU0FBUyxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7QUFtRTlDOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxRQUFrQixFQUNsQixJQUE0QixFQUM1QixFQUEwQjtJQUUxQixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUNoRSxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLG9GQUFvRjtJQUNwRixPQUFPLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1FBQ2pELElBQUksQ0FBQyxRQUFRLENBQUMsbUJBQW1CLElBQUksaUJBQWlCLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMxRSxpQkFBaUIsQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUM7WUFDN0MsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUVELElBQUksNEJBQXdDLENBQUM7UUFDN0MsTUFBTSxxQkFBcUIsR0FBRyxJQUFJLE9BQU8sQ0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQzFELDRCQUE0QixHQUFHLE9BQU8sQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUU7WUFDbkQsNEJBQTRCLEVBQUUsQ0FBQztZQUMvQiwwRkFBMEY7WUFDMUYsd0ZBQXdGO1lBQ3hGLHVGQUF1RjtZQUN2Riw4RUFBOEU7WUFDOUUsT0FBTyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sRUFBQyx1QkFBdUIsRUFBQyxHQUFHLGlCQUFpQixDQUFDO1FBQ3BELElBQUksdUJBQXVCLEVBQUUsQ0FBQztZQUM1QixxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsdUJBQXVCLENBQUMsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUN6RixDQUFDO1FBQ0QsT0FBTyxxQkFBcUIsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsbUJBQW1CLENBQUMsUUFBa0I7SUFDN0MsT0FBTyxJQUFJLE9BQU8sQ0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFO1FBQ25DLGVBQWUsQ0FBQyxPQUFPLEVBQUUsRUFBQyxRQUFRLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgTExDIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG4vLy8gPHJlZmVyZW5jZSB0eXBlcz1cIkB0eXBlcy9kb20tdmlldy10cmFuc2l0aW9uc1wiIC8+XG5cbmltcG9ydCB7RE9DVU1FTlR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBhZnRlck5leHRSZW5kZXIsXG4gIEluamVjdGlvblRva2VuLFxuICBJbmplY3RvcixcbiAgTmdab25lLFxuICBydW5JbkluamVjdGlvbkNvbnRleHQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge0FjdGl2YXRlZFJvdXRlU25hcHNob3R9IGZyb20gJy4uL3JvdXRlcl9zdGF0ZSc7XG5cbmV4cG9ydCBjb25zdCBDUkVBVEVfVklFV19UUkFOU0lUSU9OID0gbmV3IEluamVjdGlvblRva2VuPHR5cGVvZiBjcmVhdGVWaWV3VHJhbnNpdGlvbj4oXG4gIG5nRGV2TW9kZSA/ICd2aWV3IHRyYW5zaXRpb24gaGVscGVyJyA6ICcnLFxuKTtcbmV4cG9ydCBjb25zdCBWSUVXX1RSQU5TSVRJT05fT1BUSU9OUyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxcbiAgVmlld1RyYW5zaXRpb25zRmVhdHVyZU9wdGlvbnMgJiB7c2tpcE5leHRUcmFuc2l0aW9uOiBib29sZWFufVxuPihuZ0Rldk1vZGUgPyAndmlldyB0cmFuc2l0aW9uIG9wdGlvbnMnIDogJycpO1xuXG4vKipcbiAqIE9wdGlvbnMgdG8gY29uZmlndXJlIHRoZSBWaWV3IFRyYW5zaXRpb25zIGludGVncmF0aW9uIGluIHRoZSBSb3V0ZXIuXG4gKlxuICogQGV4cGVyaW1lbnRhbFxuICogQHB1YmxpY0FwaVxuICogQHNlZSB3aXRoVmlld1RyYW5zaXRpb25zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmlld1RyYW5zaXRpb25zRmVhdHVyZU9wdGlvbnMge1xuICAvKipcbiAgICogU2tpcHMgdGhlIHZlcnkgZmlyc3QgY2FsbCB0byBgc3RhcnRWaWV3VHJhbnNpdGlvbmAuIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgZGlzYWJsaW5nIHRoZVxuICAgKiBhbmltYXRpb24gZHVyaW5nIHRoZSBhcHBsaWNhdGlvbidzIGluaXRpYWwgbG9hZGluZyBwaGFzZS5cbiAgICovXG4gIHNraXBJbml0aWFsVHJhbnNpdGlvbj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEEgZnVuY3Rpb24gdG8gcnVuIGFmdGVyIHRoZSBgVmlld1RyYW5zaXRpb25gIGlzIGNyZWF0ZWQuXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgcnVuIGluIGFuIGluamVjdGlvbiBjb250ZXh0IGFuZCBjYW4gdXNlIGBpbmplY3RgLlxuICAgKi9cbiAgb25WaWV3VHJhbnNpdGlvbkNyZWF0ZWQ/OiAodHJhbnNpdGlvbkluZm86IFZpZXdUcmFuc2l0aW9uSW5mbykgPT4gdm9pZDtcbn1cblxuLyoqXG4gKiBUaGUgaW5mb3JtYXRpb24gcGFzc2VkIHRvIHRoZSBgb25WaWV3VHJhbnNpdGlvbkNyZWF0ZWRgIGZ1bmN0aW9uIHByb3ZpZGVkIGluIHRoZVxuICogYHdpdGhWaWV3VHJhbnNpdGlvbnNgIGZlYXR1cmUgb3B0aW9ucy5cbiAqXG4gKiBAcHVibGljQXBpXG4gKiBAZXhwZXJpbWVudGFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmlld1RyYW5zaXRpb25JbmZvIHtcbiAgLy8gVE9ETyhhdHNjb3R0KTogVGhpcyB0eXBlIGNhbi9zaG91bGQgYmUgdGhlIGJ1aWx0LWluIGBWaWV3VHJhbnNpdGlvbmAgdHlwZVxuICAvLyBmcm9tIEB0eXBlcy9kb20tdmlldy10cmFuc2l0aW9ucyBidXQgZXhwb3J0aW5nIHRoYXQgdHlwZSBmcm9tIHRoZSBwdWJsaWMgQVBJIGlzIGN1cnJlbnRseSBub3RcbiAgLy8gc3VwcG9ydGVkIGJ5IHRvb2xpbmcuXG4gIC8qKlxuICAgKiBUaGUgYFZpZXdUcmFuc2l0aW9uYCByZXR1cm5lZCBieSB0aGUgY2FsbCB0byBgc3RhcnRWaWV3VHJhbnNpdGlvbmAuXG4gICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1ZpZXdUcmFuc2l0aW9uXG4gICAqL1xuICB0cmFuc2l0aW9uOiB7XG4gICAgLyoqXG4gICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvVmlld1RyYW5zaXRpb24vZmluaXNoZWRcbiAgICAgKi9cbiAgICBmaW5pc2hlZDogUHJvbWlzZTx2b2lkPjtcbiAgICAvKipcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9WaWV3VHJhbnNpdGlvbi9yZWFkeVxuICAgICAqL1xuICAgIHJlYWR5OiBQcm9taXNlPHZvaWQ+O1xuICAgIC8qKlxuICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1ZpZXdUcmFuc2l0aW9uL3VwZGF0ZUNhbGxiYWNrRG9uZVxuICAgICAqL1xuICAgIHVwZGF0ZUNhbGxiYWNrRG9uZTogUHJvbWlzZTx2b2lkPjtcbiAgICAvKipcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9WaWV3VHJhbnNpdGlvbi9za2lwVHJhbnNpdGlvblxuICAgICAqL1xuICAgIHNraXBUcmFuc2l0aW9uKCk6IHZvaWQ7XG4gIH07XG4gIC8qKlxuICAgKiBUaGUgYEFjdGl2YXRlZFJvdXRlU25hcHNob3RgIHRoYXQgdGhlIG5hdmlnYXRpb24gaXMgdHJhbnNpdGlvbmluZyBmcm9tLlxuICAgKi9cbiAgZnJvbTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdDtcbiAgLyoqXG4gICAqIFRoZSBgQWN0aXZhdGVkUm91dGVTbmFwc2hvdGAgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyB0cmFuc2l0aW9uaW5nIHRvLlxuICAgKi9cbiAgdG86IEFjdGl2YXRlZFJvdXRlU25hcHNob3Q7XG59XG5cbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIHVzaW5nIGJyb3dzZXIgdmlldyB0cmFuc2l0aW9ucy4gVGhpcyBmdW5jdGlvbiBza2lwcyB0aGUgY2FsbCB0b1xuICogYHN0YXJ0Vmlld1RyYW5zaXRpb25gIGlmIHRoZSBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgaXQuXG4gKlxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgdmlldyB0cmFuc2l0aW9uIGNhbGxiYWNrIGJlZ2lucy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVZpZXdUcmFuc2l0aW9uKFxuICBpbmplY3RvcjogSW5qZWN0b3IsXG4gIGZyb206IEFjdGl2YXRlZFJvdXRlU25hcHNob3QsXG4gIHRvOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90LFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRyYW5zaXRpb25PcHRpb25zID0gaW5qZWN0b3IuZ2V0KFZJRVdfVFJBTlNJVElPTl9PUFRJT05TKTtcbiAgY29uc3QgZG9jdW1lbnQgPSBpbmplY3Rvci5nZXQoRE9DVU1FTlQpO1xuICAvLyBDcmVhdGUgcHJvbWlzZXMgb3V0c2lkZSB0aGUgQW5ndWxhciB6b25lIHRvIGF2b2lkIGNhdXNpbmcgZXh0cmEgY2hhbmdlIGRldGVjdGlvbnNcbiAgcmV0dXJuIGluamVjdG9yLmdldChOZ1pvbmUpLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICBpZiAoIWRvY3VtZW50LnN0YXJ0Vmlld1RyYW5zaXRpb24gfHwgdHJhbnNpdGlvbk9wdGlvbnMuc2tpcE5leHRUcmFuc2l0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uT3B0aW9ucy5za2lwTmV4dFRyYW5zaXRpb24gPSBmYWxzZTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG5cbiAgICBsZXQgcmVzb2x2ZVZpZXdUcmFuc2l0aW9uU3RhcnRlZDogKCkgPT4gdm9pZDtcbiAgICBjb25zdCB2aWV3VHJhbnNpdGlvblN0YXJ0ZWQgPSBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4ge1xuICAgICAgcmVzb2x2ZVZpZXdUcmFuc2l0aW9uU3RhcnRlZCA9IHJlc29sdmU7XG4gICAgfSk7XG4gICAgY29uc3QgdHJhbnNpdGlvbiA9IGRvY3VtZW50LnN0YXJ0Vmlld1RyYW5zaXRpb24oKCkgPT4ge1xuICAgICAgcmVzb2x2ZVZpZXdUcmFuc2l0aW9uU3RhcnRlZCgpO1xuICAgICAgLy8gV2UgZG9uJ3QgYWN0dWFsbHkgdXBkYXRlIGRvbSB3aXRoaW4gdGhlIHRyYW5zaXRpb24gY2FsbGJhY2suIFRoZSByZXNvbHZpbmcgb2YgdGhlIGFib3ZlXG4gICAgICAvLyBwcm9taXNlIHVuYmxvY2tzIHRoZSBSb3V0ZXIgbmF2aWdhdGlvbiwgd2hpY2ggc3luY2hyb25vdXNseSBhY3RpdmF0ZXMgYW5kIGRlYWN0aXZhdGVzXG4gICAgICAvLyByb3V0ZXMgKHRoZSBET00gdXBkYXRlKS4gVGhpcyB2aWV3IHRyYW5zaXRpb24gd2FpdHMgZm9yIHRoZSBuZXh0IGNoYW5nZSBkZXRlY3Rpb24gdG9cbiAgICAgIC8vIGNvbXBsZXRlIChiZWxvdyksIHdoaWNoIGluY2x1ZGVzIHRoZSB1cGRhdGUgcGhhc2Ugb2YgdGhlIHJvdXRlZCBjb21wb25lbnRzLlxuICAgICAgcmV0dXJuIGNyZWF0ZVJlbmRlclByb21pc2UoaW5qZWN0b3IpO1xuICAgIH0pO1xuICAgIGNvbnN0IHtvblZpZXdUcmFuc2l0aW9uQ3JlYXRlZH0gPSB0cmFuc2l0aW9uT3B0aW9ucztcbiAgICBpZiAob25WaWV3VHJhbnNpdGlvbkNyZWF0ZWQpIHtcbiAgICAgIHJ1bkluSW5qZWN0aW9uQ29udGV4dChpbmplY3RvciwgKCkgPT4gb25WaWV3VHJhbnNpdGlvbkNyZWF0ZWQoe3RyYW5zaXRpb24sIGZyb20sIHRvfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdmlld1RyYW5zaXRpb25TdGFydGVkO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIG5leHQgcmVuZGVyLlxuICovXG5mdW5jdGlvbiBjcmVhdGVSZW5kZXJQcm9taXNlKGluamVjdG9yOiBJbmplY3Rvcikge1xuICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHtcbiAgICBhZnRlck5leHRSZW5kZXIocmVzb2x2ZSwge2luamVjdG9yfSk7XG4gIH0pO1xufVxuIl19