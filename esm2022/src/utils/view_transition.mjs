/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/// <reference types="@types/dom-view-transitions" />
import { DOCUMENT } from '@angular/common';
import { afterNextRender, InjectionToken, NgZone, runInInjectionContext } from '@angular/core';
export const CREATE_VIEW_TRANSITION = new InjectionToken(ngDevMode ? 'view transition helper' : '');
export const VIEW_TRANSITION_OPTIONS = new InjectionToken(ngDevMode ? 'view transition options' : '');
/**
 * A helper function for using browser view transitions. This function skips the call to
 * `startViewTransition` if the browser does not support it.
 *
 * @returns A Promise that resolves when the view transition callback begins.
 */
export function createViewTransition(injector, from, to) {
    const transitionOptions = injector.get(VIEW_TRANSITION_OPTIONS);
    const document = injector.get(DOCUMENT);
    // Create promises outside the Angular zone to avoid causing extra change detections
    return injector.get(NgZone).runOutsideAngular(() => {
        if (!document.startViewTransition || transitionOptions.skipNextTransition) {
            transitionOptions.skipNextTransition = false;
            return Promise.resolve();
        }
        let resolveViewTransitionStarted;
        const viewTransitionStarted = new Promise((resolve) => {
            resolveViewTransitionStarted = resolve;
        });
        const transition = document.startViewTransition(() => {
            resolveViewTransitionStarted();
            // We don't actually update dom within the transition callback. The resolving of the above
            // promise unblocks the Router navigation, which synchronously activates and deactivates
            // routes (the DOM update). This view transition waits for the next change detection to
            // complete (below), which includes the update phase of the routed components.
            return createRenderPromise(injector);
        });
        const { onViewTransitionCreated } = transitionOptions;
        if (onViewTransitionCreated) {
            runInInjectionContext(injector, () => onViewTransitionCreated({ transition, from, to }));
        }
        return viewTransitionStarted;
    });
}
/**
 * Creates a promise that resolves after next render.
 */
function createRenderPromise(injector) {
    return new Promise(resolve => {
        afterNextRender(resolve, { injector });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld190cmFuc2l0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvcm91dGVyL3NyYy91dGlscy92aWV3X3RyYW5zaXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgscURBQXFEO0FBRXJELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUMsZUFBZSxFQUFFLGNBQWMsRUFBWSxNQUFNLEVBQUUscUJBQXFCLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFJdkcsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQy9CLElBQUksY0FBYyxDQUE4QixTQUFTLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUMvRixNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FDaEMsSUFBSSxjQUFjLENBQ2QsU0FBUyxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7QUFtRXBEOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLG9CQUFvQixDQUNoQyxRQUFrQixFQUFFLElBQTRCLEVBQUUsRUFBMEI7SUFDOUUsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDaEUsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN4QyxvRkFBb0Y7SUFDcEYsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtRQUNqRCxJQUFJLENBQUMsUUFBUSxDQUFDLG1CQUFtQixJQUFJLGlCQUFpQixDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDMUUsaUJBQWlCLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO1lBQzdDLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzNCLENBQUM7UUFFRCxJQUFJLDRCQUF3QyxDQUFDO1FBQzdDLE1BQU0scUJBQXFCLEdBQUcsSUFBSSxPQUFPLENBQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUMxRCw0QkFBNEIsR0FBRyxPQUFPLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsbUJBQW1CLENBQUMsR0FBRyxFQUFFO1lBQ25ELDRCQUE0QixFQUFFLENBQUM7WUFDL0IsMEZBQTBGO1lBQzFGLHdGQUF3RjtZQUN4Rix1RkFBdUY7WUFDdkYsOEVBQThFO1lBQzlFLE9BQU8sbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLEVBQUMsdUJBQXVCLEVBQUMsR0FBRyxpQkFBaUIsQ0FBQztRQUNwRCxJQUFJLHVCQUF1QixFQUFFLENBQUM7WUFDNUIscUJBQXFCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLHVCQUF1QixDQUFDLEVBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekYsQ0FBQztRQUNELE9BQU8scUJBQXFCLENBQUM7SUFDL0IsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFTLG1CQUFtQixDQUFDLFFBQWtCO0lBQzdDLE9BQU8sSUFBSSxPQUFPLENBQU8sT0FBTyxDQUFDLEVBQUU7UUFDakMsZUFBZSxDQUFDLE9BQU8sRUFBRSxFQUFDLFFBQVEsRUFBQyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwiQHR5cGVzL2RvbS12aWV3LXRyYW5zaXRpb25zXCIgLz5cblxuaW1wb3J0IHtET0NVTUVOVH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7YWZ0ZXJOZXh0UmVuZGVyLCBJbmplY3Rpb25Ub2tlbiwgSW5qZWN0b3IsIE5nWm9uZSwgcnVuSW5JbmplY3Rpb25Db250ZXh0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90fSBmcm9tICcuLi9yb3V0ZXJfc3RhdGUnO1xuXG5leHBvcnQgY29uc3QgQ1JFQVRFX1ZJRVdfVFJBTlNJVElPTiA9XG4gICAgbmV3IEluamVjdGlvblRva2VuPHR5cGVvZiBjcmVhdGVWaWV3VHJhbnNpdGlvbj4obmdEZXZNb2RlID8gJ3ZpZXcgdHJhbnNpdGlvbiBoZWxwZXInIDogJycpO1xuZXhwb3J0IGNvbnN0IFZJRVdfVFJBTlNJVElPTl9PUFRJT05TID1cbiAgICBuZXcgSW5qZWN0aW9uVG9rZW48Vmlld1RyYW5zaXRpb25zRmVhdHVyZU9wdGlvbnMme3NraXBOZXh0VHJhbnNpdGlvbjogYm9vbGVhbn0+KFxuICAgICAgICBuZ0Rldk1vZGUgPyAndmlldyB0cmFuc2l0aW9uIG9wdGlvbnMnIDogJycpO1xuXG4vKipcbiAqIE9wdGlvbnMgdG8gY29uZmlndXJlIHRoZSBWaWV3IFRyYW5zaXRpb25zIGludGVncmF0aW9uIGluIHRoZSBSb3V0ZXIuXG4gKlxuICogQGV4cGVyaW1lbnRhbFxuICogQHB1YmxpY0FwaVxuICogQHNlZSB3aXRoVmlld1RyYW5zaXRpb25zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmlld1RyYW5zaXRpb25zRmVhdHVyZU9wdGlvbnMge1xuICAvKipcbiAgICogU2tpcHMgdGhlIHZlcnkgZmlyc3QgY2FsbCB0byBgc3RhcnRWaWV3VHJhbnNpdGlvbmAuIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgZGlzYWJsaW5nIHRoZVxuICAgKiBhbmltYXRpb24gZHVyaW5nIHRoZSBhcHBsaWNhdGlvbidzIGluaXRpYWwgbG9hZGluZyBwaGFzZS5cbiAgICovXG4gIHNraXBJbml0aWFsVHJhbnNpdGlvbj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEEgZnVuY3Rpb24gdG8gcnVuIGFmdGVyIHRoZSBgVmlld1RyYW5zaXRpb25gIGlzIGNyZWF0ZWQuXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgcnVuIGluIGFuIGluamVjdGlvbiBjb250ZXh0IGFuZCBjYW4gdXNlIGBpbmplY3RgLlxuICAgKi9cbiAgb25WaWV3VHJhbnNpdGlvbkNyZWF0ZWQ/OiAodHJhbnNpdGlvbkluZm86IFZpZXdUcmFuc2l0aW9uSW5mbykgPT4gdm9pZDtcbn1cblxuLyoqXG4gKiBUaGUgaW5mb3JtYXRpb24gcGFzc2VkIHRvIHRoZSBgb25WaWV3VHJhbnNpdGlvbkNyZWF0ZWRgIGZ1bmN0aW9uIHByb3ZpZGVkIGluIHRoZVxuICogYHdpdGhWaWV3VHJhbnNpdGlvbnNgIGZlYXR1cmUgb3B0aW9ucy5cbiAqXG4gKiBAcHVibGljQXBpXG4gKiBAZXhwZXJpbWVudGFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmlld1RyYW5zaXRpb25JbmZvIHtcbiAgLy8gVE9ETyhhdHNjb3R0KTogVGhpcyB0eXBlIGNhbi9zaG91bGQgYmUgdGhlIGJ1aWx0LWluIGBWaWV3VHJhbnNpdGlvbmAgdHlwZVxuICAvLyBmcm9tIEB0eXBlcy9kb20tdmlldy10cmFuc2l0aW9ucyBidXQgZXhwb3J0aW5nIHRoYXQgdHlwZSBmcm9tIHRoZSBwdWJsaWMgQVBJIGlzIGN1cnJlbnRseSBub3RcbiAgLy8gc3VwcG9ydGVkIGJ5IHRvb2xpbmcuXG4gIC8qKlxuICAgKiBUaGUgYFZpZXdUcmFuc2l0aW9uYCByZXR1cm5lZCBieSB0aGUgY2FsbCB0byBgc3RhcnRWaWV3VHJhbnNpdGlvbmAuXG4gICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1ZpZXdUcmFuc2l0aW9uXG4gICAqL1xuICB0cmFuc2l0aW9uOiB7XG4gICAgLyoqXG4gICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvVmlld1RyYW5zaXRpb24vZmluaXNoZWRcbiAgICAgKi9cbiAgICBmaW5pc2hlZDogUHJvbWlzZTx2b2lkPixcbiAgICAvKipcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9WaWV3VHJhbnNpdGlvbi9yZWFkeVxuICAgICAqL1xuICAgIHJlYWR5OiBQcm9taXNlPHZvaWQ+LFxuICAgIC8qKlxuICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1ZpZXdUcmFuc2l0aW9uL3VwZGF0ZUNhbGxiYWNrRG9uZVxuICAgICAqL1xuICAgIHVwZGF0ZUNhbGxiYWNrRG9uZTogUHJvbWlzZTx2b2lkPixcbiAgICAvKipcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9WaWV3VHJhbnNpdGlvbi9za2lwVHJhbnNpdGlvblxuICAgICAqL1xuICAgIHNraXBUcmFuc2l0aW9uKCk6IHZvaWQsXG4gIH07XG4gIC8qKlxuICAgKiBUaGUgYEFjdGl2YXRlZFJvdXRlU25hcHNob3RgIHRoYXQgdGhlIG5hdmlnYXRpb24gaXMgdHJhbnNpdGlvbmluZyBmcm9tLlxuICAgKi9cbiAgZnJvbTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdDtcbiAgLyoqXG4gICAqIFRoZSBgQWN0aXZhdGVkUm91dGVTbmFwc2hvdGAgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyB0cmFuc2l0aW9uaW5nIHRvLlxuICAgKi9cbiAgdG86IEFjdGl2YXRlZFJvdXRlU25hcHNob3Q7XG59XG5cbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIHVzaW5nIGJyb3dzZXIgdmlldyB0cmFuc2l0aW9ucy4gVGhpcyBmdW5jdGlvbiBza2lwcyB0aGUgY2FsbCB0b1xuICogYHN0YXJ0Vmlld1RyYW5zaXRpb25gIGlmIHRoZSBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgaXQuXG4gKlxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgdmlldyB0cmFuc2l0aW9uIGNhbGxiYWNrIGJlZ2lucy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVZpZXdUcmFuc2l0aW9uKFxuICAgIGluamVjdG9yOiBJbmplY3RvciwgZnJvbTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgdG86IEFjdGl2YXRlZFJvdXRlU25hcHNob3QpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgdHJhbnNpdGlvbk9wdGlvbnMgPSBpbmplY3Rvci5nZXQoVklFV19UUkFOU0lUSU9OX09QVElPTlMpO1xuICBjb25zdCBkb2N1bWVudCA9IGluamVjdG9yLmdldChET0NVTUVOVCk7XG4gIC8vIENyZWF0ZSBwcm9taXNlcyBvdXRzaWRlIHRoZSBBbmd1bGFyIHpvbmUgdG8gYXZvaWQgY2F1c2luZyBleHRyYSBjaGFuZ2UgZGV0ZWN0aW9uc1xuICByZXR1cm4gaW5qZWN0b3IuZ2V0KE5nWm9uZSkucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgIGlmICghZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbiB8fCB0cmFuc2l0aW9uT3B0aW9ucy5za2lwTmV4dFRyYW5zaXRpb24pIHtcbiAgICAgIHRyYW5zaXRpb25PcHRpb25zLnNraXBOZXh0VHJhbnNpdGlvbiA9IGZhbHNlO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIGxldCByZXNvbHZlVmlld1RyYW5zaXRpb25TdGFydGVkOiAoKSA9PiB2b2lkO1xuICAgIGNvbnN0IHZpZXdUcmFuc2l0aW9uU3RhcnRlZCA9IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiB7XG4gICAgICByZXNvbHZlVmlld1RyYW5zaXRpb25TdGFydGVkID0gcmVzb2x2ZTtcbiAgICB9KTtcbiAgICBjb25zdCB0cmFuc2l0aW9uID0gZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbigoKSA9PiB7XG4gICAgICByZXNvbHZlVmlld1RyYW5zaXRpb25TdGFydGVkKCk7XG4gICAgICAvLyBXZSBkb24ndCBhY3R1YWxseSB1cGRhdGUgZG9tIHdpdGhpbiB0aGUgdHJhbnNpdGlvbiBjYWxsYmFjay4gVGhlIHJlc29sdmluZyBvZiB0aGUgYWJvdmVcbiAgICAgIC8vIHByb21pc2UgdW5ibG9ja3MgdGhlIFJvdXRlciBuYXZpZ2F0aW9uLCB3aGljaCBzeW5jaHJvbm91c2x5IGFjdGl2YXRlcyBhbmQgZGVhY3RpdmF0ZXNcbiAgICAgIC8vIHJvdXRlcyAodGhlIERPTSB1cGRhdGUpLiBUaGlzIHZpZXcgdHJhbnNpdGlvbiB3YWl0cyBmb3IgdGhlIG5leHQgY2hhbmdlIGRldGVjdGlvbiB0b1xuICAgICAgLy8gY29tcGxldGUgKGJlbG93KSwgd2hpY2ggaW5jbHVkZXMgdGhlIHVwZGF0ZSBwaGFzZSBvZiB0aGUgcm91dGVkIGNvbXBvbmVudHMuXG4gICAgICByZXR1cm4gY3JlYXRlUmVuZGVyUHJvbWlzZShpbmplY3Rvcik7XG4gICAgfSk7XG4gICAgY29uc3Qge29uVmlld1RyYW5zaXRpb25DcmVhdGVkfSA9IHRyYW5zaXRpb25PcHRpb25zO1xuICAgIGlmIChvblZpZXdUcmFuc2l0aW9uQ3JlYXRlZCkge1xuICAgICAgcnVuSW5JbmplY3Rpb25Db250ZXh0KGluamVjdG9yLCAoKSA9PiBvblZpZXdUcmFuc2l0aW9uQ3JlYXRlZCh7dHJhbnNpdGlvbiwgZnJvbSwgdG99KSk7XG4gICAgfVxuICAgIHJldHVybiB2aWV3VHJhbnNpdGlvblN0YXJ0ZWQ7XG4gIH0pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgbmV4dCByZW5kZXIuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVJlbmRlclByb21pc2UoaW5qZWN0b3I6IEluamVjdG9yKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcbiAgICBhZnRlck5leHRSZW5kZXIocmVzb2x2ZSwge2luamVjdG9yfSk7XG4gIH0pO1xufVxuIl19