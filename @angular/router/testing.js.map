{"version":3,"file":"testing.js","sources":["../../../../../packages/router/testing/index.ts","../../../../../packages/router/testing/src/testing.ts","../../../../../packages/router/testing/src/router_testing_module.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of the router/testing package.\n */\n\nexport * from './src/testing';\n","/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of the router/testing package.\n */\nexport * from './router_testing_module';\n","/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Location, LocationStrategy} from '@angular/common';\nimport {MockLocationStrategy, SpyLocation} from '@angular/common/testing';\nimport {Compiler, Injectable, Injector, ModuleWithProviders, NgModule, NgModuleFactory, NgModuleFactoryLoader, Optional} from '@angular/core';\nimport {ChildrenOutletContexts, NoPreloading, PreloadingStrategy, ROUTES, Route, Router, RouterModule, Routes, UrlHandlingStrategy, UrlSerializer, provideRoutes, ɵROUTER_PROVIDERS as ROUTER_PROVIDERS, ɵflatten as flatten} from '@angular/router';\n\n\n\n/**\n * @whatItDoes Allows to simulate the loading of ng modules in tests.\n *\n * @howToUse\n *\n * ```\n * const loader = TestBed.get(NgModuleFactoryLoader);\n *\n * @Component({template: 'lazy-loaded'})\n * class LazyLoadedComponent {}\n * @NgModule({\n *   declarations: [LazyLoadedComponent],\n *   imports: [RouterModule.forChild([{path: 'loaded', component: LazyLoadedComponent}])]\n * })\n *\n * class LoadedModule {}\n *\n * // sets up stubbedModules\n * loader.stubbedModules = {lazyModule: LoadedModule};\n *\n * router.resetConfig([\n *   {path: 'lazy', loadChildren: 'lazyModule'},\n * ]);\n *\n * router.navigateByUrl('/lazy/loaded');\n * ```\n *\n * @stable\n */\n\nexport class SpyNgModuleFactoryLoader implements NgModuleFactoryLoader {\n  /**\n   * @docsNotRequired\n   */\n  private _stubbedModules: {[path: string]: Promise<NgModuleFactory<any>>} = {};\n\n  /**\n   * @docsNotRequired\n   */\n  set stubbedModules(modules: {[path: string]: any}) {\n    const res: {[path: string]: any} = {};\n    for (const t of Object.keys(modules)) {\n      res[t] = this.compiler.compileModuleAsync(modules[t]);\n    }\n    this._stubbedModules = res;\n  }\n\n  /**\n   * @docsNotRequired\n   */\n  get stubbedModules(): {[path: string]: any} { return this._stubbedModules; }\n\n  constructor(private compiler: Compiler) {}\n\n  load(path: string): Promise<NgModuleFactory<any>> {\n    if (this._stubbedModules[path]) {\n      return this._stubbedModules[path];\n    } else {\n      return <any>Promise.reject(new Error(`Cannot find module ${path}`));\n    }\n  }\nstatic decorators: {type: Function, args?: any[]}[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: {type: Function, args?: any[]}[]}|null)[] = () => [\n{type: Compiler, },\n];\n}\n\n/**\n * Router setup factory function used for testing.\n *\n * @stable\n */\nexport function setupTestingRouter(\n    urlSerializer: UrlSerializer, contexts: ChildrenOutletContexts, location: Location,\n    loader: NgModuleFactoryLoader, compiler: Compiler, injector: Injector, routes: Route[][],\n    urlHandlingStrategy?: UrlHandlingStrategy) {\n  const router = new Router(\n      null !, urlSerializer, contexts, location, injector, loader, compiler, flatten(routes));\n  if (urlHandlingStrategy) {\n    router.urlHandlingStrategy = urlHandlingStrategy;\n  }\n  return router;\n}\n\n/**\n * @whatItDoes Sets up the router to be used for testing.\n *\n * @howToUse\n *\n * ```\n * beforeEach(() => {\n *   TestBed.configureTestModule({\n *     imports: [\n *       RouterTestingModule.withRoutes(\n *         [{path: '', component: BlankCmp}, {path: 'simple', component: SimpleCmp}])]\n *       )\n *     ]\n *   });\n * });\n * ```\n *\n * @description\n *\n * The modules sets up the router to be used for testing.\n * It provides spy implementations of {@link Location}, {@link LocationStrategy}, and {@link\n * NgModuleFactoryLoader}.\n *\n * @stable\n */\n\nexport class RouterTestingModule {\n  static withRoutes(routes: Routes): ModuleWithProviders {\n    return {ngModule: RouterTestingModule, providers: [provideRoutes(routes)]};\n  }\nstatic decorators: {type: Function, args?: any[]}[] = [\n{ type: NgModule, args: [{\n  exports: [RouterModule],\n  providers: [\n    ROUTER_PROVIDERS, {provide: Location, useClass: SpyLocation},\n    {provide: LocationStrategy, useClass: MockLocationStrategy},\n    {provide: NgModuleFactoryLoader, useClass: SpyNgModuleFactoryLoader}, {\n      provide: Router,\n      useFactory: setupTestingRouter,\n      deps: [\n        UrlSerializer, ChildrenOutletContexts, Location, NgModuleFactoryLoader, Compiler, Injector,\n        ROUTES, [UrlHandlingStrategy, new Optional()]\n      ]\n    },\n    {provide: PreloadingStrategy, useExisting: NoPreloading}, provideRoutes([])\n  ]\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: {type: Function, args?: any[]}[]}|null)[] = () => [\n];\n}\n"],"names":["ROUTER_PROVIDERS","flatten"],"mappings":"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"}